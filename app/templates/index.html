{% extends "base.html" %}

{% block content %}
<div class="text-center py-8 md:py-12">
    <div class="flex items-center justify-center gap-3 mb-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 md:h-14 md:w-14" viewBox="0 0 48 40" fill="none">
            <g transform="rotate(6, 30, 14)">
                <rect x="14" y="2" width="28" height="22" rx="2" class="stroke-secondary" stroke-width="1.5" fill="none" opacity="0.8"/>
                <rect x="16" y="4" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="21" y="4" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="26" y="4" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="31" y="4" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="36" y="4" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="16" y="19.5" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="21" y="19.5" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="26" y="19.5" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="31" y="19.5" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="36" y="19.5" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="17" y="8" width="22" height="10" rx="1" class="stroke-secondary" stroke-width="1" fill="none" opacity="0.5"/>
                <path d="M28 10.5l1.2 2.4 2.6.4-1.9 1.8.5 2.6L28 16.4l-2.3 1.3.5-2.6-1.9-1.8 2.6-.4z" class="fill-secondary" opacity="0.5"/>
            </g>
            <g transform="rotate(-3, 15, 24)">
                <rect x="2" y="12" width="28" height="22" rx="2" class="stroke-primary fill-base-100" stroke-width="1.5"/>
                <rect x="4" y="14" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="9" y="14" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="14" y="14" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="19" y="14" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="24" y="14" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="4" y="29.5" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="9" y="29.5" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="14" y="29.5" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="19" y="29.5" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="24" y="29.5" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="5" y="18" width="22" height="10" rx="1" class="stroke-primary" stroke-width="1" fill="none" opacity="0.5"/>
                <circle cx="16" cy="21.5" r="2" class="fill-primary" opacity="0.6"/>
                <path d="M12 27.5c0-2.2 1.8-4 4-4s4 1.8 4 4" class="stroke-primary fill-none" stroke-width="1.2" opacity="0.6"/>
            </g>
        </svg>
        <h1 class="text-4xl md:text-5xl font-bold">
            <span class="bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
                SameCast
            </span>
        </h1>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 md:h-14 md:w-14" viewBox="0 0 48 40" fill="none" style="transform: scaleX(-1);">
            <g transform="rotate(6, 30, 14)">
                <rect x="14" y="2" width="28" height="22" rx="2" class="stroke-secondary" stroke-width="1.5" fill="none" opacity="0.8"/>
                <rect x="16" y="4" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="21" y="4" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="26" y="4" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="31" y="4" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="36" y="4" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="16" y="19.5" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="21" y="19.5" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="26" y="19.5" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="31" y="19.5" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="36" y="19.5" width="3" height="2.5" rx="0.5" class="fill-secondary" opacity="0.4"/>
                <rect x="17" y="8" width="22" height="10" rx="1" class="stroke-secondary" stroke-width="1" fill="none" opacity="0.5"/>
                <path d="M28 10.5l1.2 2.4 2.6.4-1.9 1.8.5 2.6L28 16.4l-2.3 1.3.5-2.6-1.9-1.8 2.6-.4z" class="fill-secondary" opacity="0.5"/>
            </g>
            <g transform="rotate(-3, 15, 24)">
                <rect x="2" y="12" width="28" height="22" rx="2" class="stroke-primary fill-base-100" stroke-width="1.5"/>
                <rect x="4" y="14" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="9" y="14" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="14" y="14" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="19" y="14" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="24" y="14" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="4" y="29.5" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="9" y="29.5" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="14" y="29.5" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="19" y="29.5" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="24" y="29.5" width="3" height="2.5" rx="0.5" class="fill-primary" opacity="0.4"/>
                <rect x="5" y="18" width="22" height="10" rx="1" class="stroke-primary" stroke-width="1" fill="none" opacity="0.5"/>
                <circle cx="16" cy="21.5" r="2" class="fill-primary" opacity="0.6"/>
                <path d="M12 27.5c0-2.2 1.8-4 4-4s4 1.8 4 4" class="stroke-primary fill-none" stroke-width="1.2" opacity="0.6"/>
            </g>
        </svg>
    </div>
    <p class="text-lg text-base-content/70 mb-4">
        Discover shared cast &amp; crew between any two movies or TV shows
    </p>

    <div id="suggestion-container" class="h-8 mb-6 flex items-center justify-center">
        <p id="suggestion-text" class="text-sm text-base-content/50 italic suggestion-visible"></p>
    </div>

    <form id="compare-form" hx-get="/compare" hx-target="#results" hx-swap="innerHTML"
          hx-indicator="#loading" class="max-w-4xl mx-auto">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- Slot 1 -->
            <div class="space-y-3">
                <label class="text-sm font-semibold opacity-70 uppercase tracking-wider">Title 1</label>
                <div class="relative">
                    <input id="search-1" type="text" placeholder="Search for a movie or TV show..."
                           class="input input-bordered w-full"
                           autocomplete="off"
                           hx-get="/search/autocomplete"
                           hx-trigger="input changed delay:400ms, keyup changed delay:400ms"
                           hx-target="#dropdown-1"
                           hx-swap="innerHTML"
                           hx-include="[id='search-1']"
                           hx-vals='{"slot": "1"}'
                           name="q">
                    <div id="dropdown-1" class="absolute z-40 w-full mt-1"></div>
                </div>
                <div id="selected-1" class="min-h-[80px]">
                    <p class="text-center opacity-40 py-8">Search above to pick a title</p>
                </div>
            </div>

            <!-- Slot 2 -->
            <div class="space-y-3">
                <label class="text-sm font-semibold opacity-70 uppercase tracking-wider">Title 2</label>
                <div class="relative">
                    <input id="search-2" type="text" placeholder="Search for a movie or TV show..."
                           class="input input-bordered w-full"
                           autocomplete="off"
                           hx-get="/search/autocomplete"
                           hx-trigger="input changed delay:400ms, keyup changed delay:400ms"
                           hx-target="#dropdown-2"
                           hx-swap="innerHTML"
                           hx-include="[id='search-2']"
                           hx-vals='{"slot": "2"}'
                           name="q">
                    <div id="dropdown-2" class="absolute z-40 w-full mt-1"></div>
                </div>
                <div id="selected-2" class="min-h-[80px]">
                    <p class="text-center opacity-40 py-8">Search above to pick a title</p>
                </div>
            </div>
        </div>

        <button id="compare-btn" type="submit" class="btn btn-primary btn-lg gap-2" disabled>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
            </svg>
            Compare
        </button>
    </form>

    <!-- Loading indicator -->
    <div id="loading" class="htmx-indicator py-8">
        <span class="loading loading-dots loading-lg text-primary"></span>
        <p class="text-sm opacity-60 mt-2">Finding shared cast &amp; crew...</p>
    </div>

    <!-- Results area -->
    <div id="results" class="mt-8"></div>
</div>

<script>
(function() {
    var suggestions = {{ suggestions_json | safe }};
    if (suggestions.length === 0) return;
    var el = document.getElementById('suggestion-text');
    var idx = Math.floor(Math.random() * suggestions.length);

    function show(s) {
        el.textContent = "Try comparing \u2018" + s.title_1 + "\u2019 and \u2018" + s.title_2 + "\u2019";
    }

    show(suggestions[idx]);

    if (suggestions.length > 1) {
        setInterval(function() {
            el.classList.remove('suggestion-visible');
            el.classList.add('suggestion-hidden');
            setTimeout(function() {
                idx = (idx + 1) % suggestions.length;
                show(suggestions[idx]);
                el.classList.remove('suggestion-hidden');
                el.classList.add('suggestion-visible');
            }, 500);
        }, 60000);
    }
})();

function checkCompareButton() {
    const has1 = document.querySelector('input[name="title_id_1"]');
    const has2 = document.querySelector('input[name="title_id_2"]');
    const btn = document.getElementById('compare-btn');
    btn.disabled = !(has1 && has2);
}

// Close dropdowns when clicking outside
document.addEventListener('click', function(e) {
    if (!e.target.closest('#search-1') && !e.target.closest('#dropdown-1')) {
        document.getElementById('dropdown-1').innerHTML = '';
    }
    if (!e.target.closest('#search-2') && !e.target.closest('#dropdown-2')) {
        document.getElementById('dropdown-2').innerHTML = '';
    }
});
</script>
{% endblock %}
